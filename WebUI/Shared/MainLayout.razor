@inherits LayoutComponentBase
@using WebUI.Components
@using WebUI.Services
@using WebUI.Services.Interfaces
@inject ILoadingService LoadingService
@inject IAuthService AuthService
@implements IDisposable

<div class="page">
    <TopBar />
    <Header />
    <BrandSlider />

    <main>
        @Body
    </main>

    <Footer />
</div>

<ToastNotification />

<!-- Global Loading Spinner -->
<LoadingSpinner 
    IsVisible="LoadingService.IsLoading"
    Title="LoadingService.Title"
    Message="LoadingService.Message"
    IconClass="LoadingService.IconClass"
    ShowProgress="LoadingService.ShowProgress"
    ProgressValue="LoadingService.ProgressValue" />

@code {
    protected override async Task OnInitializedAsync()
    {
        LoadingService.OnStateChanged += StateHasChanged;
        
        // Initialize AuthService để load auth state từ localStorage
        await AuthService.InitializeAsync();
    }

    public void Dispose()
    {
        LoadingService.OnStateChanged -= StateHasChanged;
    }
}