@* Pagination Component - Reusable *@

<div class="flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6 rounded-b-2xl">
    <div class="flex flex-1 justify-between sm:hidden">
        <button @onclick="PreviousPage" 
                disabled="@(CurrentPage <= 1)"
                class="relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
            Trước
        </button>
        <button @onclick="NextPage" 
                disabled="@(CurrentPage >= TotalPages)"
                class="relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
            Sau
        </button>
    </div>
    <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
        <div>
            <p class="text-sm text-gray-700">
                Hiển thị 
                <span class="font-medium">@StartItem</span>
                đến
                <span class="font-medium">@EndItem</span>
                trong tổng số
                <span class="font-medium">@TotalItems</span>
                kết quả
            </p>
        </div>
        <div>
            <nav class="isolate inline-flex -space-x-px rounded-md shadow-sm" aria-label="Pagination">
                <button @onclick="PreviousPage" 
                        disabled="@(CurrentPage <= 1)"
                        class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed">
                    <span class="sr-only">Trước</span>
                    <i class="fas fa-chevron-left h-5 w-5"></i>
                </button>
                
                @foreach (var pageNum in GetPageNumbers())
                {
                    @if (pageNum == CurrentPage)
                    {
                        <button class="relative z-10 inline-flex items-center bg-blue-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600">
                            @pageNum
                        </button>
                    }
                    else if (pageNum == -1)
                    {
                        <span class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700 ring-1 ring-inset ring-gray-300">
                            ...
                        </span>
                    }
                    else
                    {
                        <button @onclick="() => GoToPage(pageNum)"
                                class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                            @pageNum
                        </button>
                    }
                }
                
                <button @onclick="NextPage" 
                        disabled="@(CurrentPage >= TotalPages)"
                        class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed">
                    <span class="sr-only">Sau</span>
                    <i class="fas fa-chevron-right h-5 w-5"></i>
                </button>
            </nav>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public int CurrentPage { get; set; } = 1;
    
    [Parameter]
    public int TotalItems { get; set; }
    
    [Parameter]
    public int ItemsPerPage { get; set; } = 10;
    
    [Parameter]
    public EventCallback<int> OnPageChanged { get; set; }
    
    private int TotalPages => (int)Math.Ceiling((double)TotalItems / ItemsPerPage);
    private int StartItem => TotalItems == 0 ? 0 : (CurrentPage - 1) * ItemsPerPage + 1;
    private int EndItem => Math.Min(CurrentPage * ItemsPerPage, TotalItems);
    
    private async Task GoToPage(int page)
    {
        if (page >= 1 && page <= TotalPages && page != CurrentPage)
        {
            await OnPageChanged.InvokeAsync(page);
        }
    }
    
    private async Task PreviousPage()
    {
        if (CurrentPage > 1)
        {
            await GoToPage(CurrentPage - 1);
        }
    }
    
    private async Task NextPage()
    {
        if (CurrentPage < TotalPages)
        {
            await GoToPage(CurrentPage + 1);
        }
    }
    
    private List<int> GetPageNumbers()
    {
        var pages = new List<int>();
        
        if (TotalPages <= 7)
        {
            for (int i = 1; i <= TotalPages; i++)
            {
                pages.Add(i);
            }
        }
        else
        {
            if (CurrentPage <= 3)
            {
                for (int i = 1; i <= 4; i++) pages.Add(i);
                pages.Add(-1); // ellipsis
                pages.Add(TotalPages);
            }
            else if (CurrentPage >= TotalPages - 2)
            {
                pages.Add(1);
                pages.Add(-1); // ellipsis
                for (int i = TotalPages - 3; i <= TotalPages; i++) pages.Add(i);
            }
            else
            {
                pages.Add(1);
                pages.Add(-1); // ellipsis
                for (int i = CurrentPage - 1; i <= CurrentPage + 1; i++) pages.Add(i);
                pages.Add(-1); // ellipsis
                pages.Add(TotalPages);
            }
        }
        
        return pages;
    }
}
