@* Pagination Component - Reusable *@

<style>
    .pagination-wrapper {
        background: linear-gradient(to right, #f8fafc, #ffffff);
        border-top: 2px solid #e2e8f0;
        padding: 1rem 1.5rem;
        border-radius: 0 0 1rem 1rem;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.02);
    }

    .pagination-info {
        color: #475569;
        font-size: 0.875rem;
        font-weight: 500;
    }

    .pagination-info-highlight {
        color: #3b82f6;
        font-weight: 700;
        padding: 0.125rem 0.375rem;
        background: linear-gradient(135deg, #dbeafe, #bfdbfe);
        border-radius: 0.375rem;
        display: inline-block;
        margin: 0 0.125rem;
    }

    .pagination-nav {
        display: inline-flex;
        gap: 0.375rem;
        background: white;
        padding: 0.375rem;
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .pagination-btn {
        position: relative;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 2.5rem;
        height: 2.5rem;
        padding: 0 0.75rem;
        font-size: 0.875rem;
        font-weight: 600;
        border-radius: 0.5rem;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid transparent;
        cursor: pointer;
    }

    .pagination-btn:not(:disabled):hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
    }

    .pagination-btn:active {
        transform: translateY(0);
    }

    .pagination-btn-nav {
        background: linear-gradient(135deg, #eff6ff, #dbeafe);
        color: #3b82f6;
        border-color: #93c5fd;
    }

    .pagination-btn-nav:not(:disabled):hover {
        background: linear-gradient(135deg, #dbeafe, #bfdbfe);
        border-color: #60a5fa;
    }

    .pagination-btn-nav:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        background: #f1f5f9;
        color: #cbd5e1;
        border-color: #e2e8f0;
    }

    .pagination-btn-page {
        background: white;
        color: #3b82f6;
        border-color: #dbeafe;
    }

    .pagination-btn-page:hover {
        background: linear-gradient(135deg, #eff6ff, #dbeafe);
        border-color: #93c5fd;
    }

    .pagination-btn-active {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        border-color: #2563eb;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }

    .pagination-btn-active:hover {
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(59, 130, 246, 0.5);
    }

    .pagination-ellipsis {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 2.5rem;
        height: 2.5rem;
        color: #94a3b8;
        font-weight: 700;
        font-size: 1rem;
    }

    .pagination-mobile {
        display: flex;
        gap: 0.75rem;
        width: 100%;
    }

    .pagination-mobile .pagination-btn {
        flex: 1;
        min-width: auto;
    }

    @@media (min-width: 640px) {
        .pagination-mobile {
            display: none;
        }
    }

    @@media (max-width: 639px) {
        .pagination-desktop {
            display: none !important;
        }

        .pagination-wrapper {
            padding: 0.75rem 1rem;
        }
    }
</style>

<div class="pagination-wrapper">
    <!-- Mobile Version -->
    <div class="pagination-mobile">
        <button @onclick="PreviousPage" 
                disabled="@(CurrentPage <= 1)"
                class="pagination-btn pagination-btn-nav">
            <i class="fas fa-chevron-left me-2"></i>
            Trước
        </button>
        <button @onclick="NextPage" 
                disabled="@(CurrentPage >= TotalPages)"
                class="pagination-btn pagination-btn-nav">
            Sau
            <i class="fas fa-chevron-right ms-2"></i>
        </button>
    </div>

    <!-- Desktop Version -->
    <div class="pagination-desktop d-flex align-items-center justify-content-between">
        <div class="pagination-info">
            Hiển thị 
            <span class="pagination-info-highlight">@StartItem</span>
            đến
            <span class="pagination-info-highlight">@EndItem</span>
            trong tổng số
            <span class="pagination-info-highlight">@TotalItems</span>
            kết quả
        </div>
        
        <nav class="pagination-nav" aria-label="Pagination">
            <button @onclick="PreviousPage" 
                    disabled="@(CurrentPage <= 1)"
                    class="pagination-btn pagination-btn-nav"
                    title="Trang trước">
                <i class="fas fa-chevron-left"></i>
            </button>
            
            @foreach (var pageNum in GetPageNumbers())
            {
                @if (pageNum == CurrentPage)
                {
                    <button class="pagination-btn pagination-btn-active">
                        @pageNum
                    </button>
                }
                else if (pageNum == -1)
                {
                    <span class="pagination-ellipsis">...</span>
                }
                else
                {
                    <button @onclick="() => GoToPage(pageNum)"
                            class="pagination-btn pagination-btn-page"
                            title="Đi tới trang @pageNum">
                        @pageNum
                    </button>
                }
            }
            
            <button @onclick="NextPage" 
                    disabled="@(CurrentPage >= TotalPages)"
                    class="pagination-btn pagination-btn-nav"
                    title="Trang sau">
                <i class="fas fa-chevron-right"></i>
            </button>
        </nav>
    </div>
</div>

@code {
    [Parameter]
    public int CurrentPage { get; set; } = 1;
    
    [Parameter]
    public int TotalItems { get; set; }
    
    [Parameter]
    public int ItemsPerPage { get; set; } = 10;
    
    [Parameter]
    public EventCallback<int> OnPageChanged { get; set; }
    
    private int TotalPages => (int)Math.Ceiling((double)TotalItems / ItemsPerPage);
    private int StartItem => TotalItems == 0 ? 0 : (CurrentPage - 1) * ItemsPerPage + 1;
    private int EndItem => Math.Min(CurrentPage * ItemsPerPage, TotalItems);
    
    private async Task GoToPage(int page)
    {
        if (page >= 1 && page <= TotalPages && page != CurrentPage)
        {
            await OnPageChanged.InvokeAsync(page);
        }
    }
    
    private async Task PreviousPage()
    {
        if (CurrentPage > 1)
        {
            await GoToPage(CurrentPage - 1);
        }
    }
    
    private async Task NextPage()
    {
        if (CurrentPage < TotalPages)
        {
            await GoToPage(CurrentPage + 1);
        }
    }
    
    private List<int> GetPageNumbers()
    {
        var pages = new List<int>();
        
        if (TotalPages <= 7)
        {
            for (int i = 1; i <= TotalPages; i++)
            {
                pages.Add(i);
            }
        }
        else
        {
            if (CurrentPage <= 3)
            {
                for (int i = 1; i <= 4; i++) pages.Add(i);
                pages.Add(-1); // ellipsis
                pages.Add(TotalPages);
            }
            else if (CurrentPage >= TotalPages - 2)
            {
                pages.Add(1);
                pages.Add(-1); // ellipsis
                for (int i = TotalPages - 3; i <= TotalPages; i++) pages.Add(i);
            }
            else
            {
                pages.Add(1);
                pages.Add(-1); // ellipsis
                for (int i = CurrentPage - 1; i <= CurrentPage + 1; i++) pages.Add(i);
                pages.Add(-1); // ellipsis
                pages.Add(TotalPages);
            }
        }
        
        return pages;
    }
}
